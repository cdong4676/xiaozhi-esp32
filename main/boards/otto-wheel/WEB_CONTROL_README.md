# Otto Wheel Web控制功能说明

## 功能概述

本实现为otto-wheel模块添加了HTML网页控制功能，无需修改程序主体，通过HTTP服务器提供Web界面来控制Otto机器人。

## 实现文件

- `otto_web_server.h` - Web服务器头文件
- `otto_web_server.cc` - Web服务器实现文件
- `config.h` - 已包含Web控制配置

## 功能特性

### 🎨 现代化Web界面
- 响应式设计，支持手机和电脑访问
- 渐变背景和毛玻璃效果
- 直观的控制按钮和滑块
- 实时状态显示

### 🚶 基础移动控制
- 方向控制：前进、后退、左转、右转
- 步数调节：1-10步可调
- 速度调节：500-1500ms可调
- 方向键盘式布局

### 🎯 模式控制
- 轮子模式切换
- 脚部模式切换
- 退出轮子模式
- 回到原位功能

### ⚡ 系统控制
- 紧急停止按钮
- 状态刷新
- 电池电量检查
- 实时电池电量显示条

### 📡 API接口
- `GET /` - 主控制页面
- `POST /api/control` - 机器人控制命令
- `GET /api/status` - 获取机器人状态
- `GET /api/battery` - 获取电池信息

## 使用方法

1. **编译和烧录**
   - 确保选择了otto-wheel板型配置
   - 编译并烧录固件到ESP32设备

2. **连接Wi-Fi**
   - 设备启动后会自动连接配置的Wi-Fi网络
   - 连接成功后会自动启动Web服务器

3. **访问控制界面**
   - 在浏览器中访问设备IP地址
   - 默认端口：80
   - 地址格式：`http://设备IP地址:80`

4. **控制机器人**
   - 使用方向键控制移动
   - 调节步数和速度滑块
   - 切换不同的运动模式
   - 监控电池状态

## 技术实现

### MCP协议集成
- 通过MCP服务器调用现有的机器人控制工具
- 支持所有已注册的Otto控制命令
- JSON-RPC 2.0协议通信

### HTTP服务器
- 基于ESP-IDF的esp_http_server组件
- 支持GET和POST请求
- JSON数据交换格式
- 错误处理和状态码返回

### 前端界面
- 纯HTML/CSS/JavaScript实现
- 无外部依赖
- 异步AJAX通信
- 定时状态更新（2秒间隔）

## 配置选项

在`config.h`中的相关配置：
```cpp
#define CONFIG_OTTO_WEB_CONTROL_ENABLED 1
#define OTTO_WEB_SERVER_PORT 80
```

## 支持的MCP工具

- `self.otto.walk_forward` - 前进/后退
- `self.otto.turn_left` - 左转/右转
- `self.otto.wheel_mode` - 切换到轮子模式
- `self.otto.foot_mode` - 切换到脚部模式
- `self.otto.exit_wheel_mode` - 退出轮子模式
- `self.otto.stop` - 停止运动
- `self.otto.get_status` - 获取状态
- `self.battery.get_level` - 获取电池电量

## 安全考虑

- 仅在本地网络中提供服务
- 无身份验证（适用于受信任的网络环境）
- 紧急停止功能随时可用
- 输入参数验证和错误处理

## 故障排除

1. **无法访问Web界面**
   - 检查设备是否成功连接Wi-Fi
   - 确认设备IP地址
   - 检查防火墙设置

2. **控制命令无响应**
   - 查看串口日志输出
   - 确认MCP服务器正常运行
   - 检查机器人硬件连接

3. **编译错误**
   - 确保ESP-IDF环境正确配置
   - 检查所有依赖组件是否启用
   - 验证板型配置选择

## 扩展功能

可以通过修改代码添加更多功能：
- 用户身份验证
- 更多机器人动作
- 实时视频流（如果有摄像头）
- 语音控制集成
- 移动应用支持

## 注意事项

- 确保网络稳定性以获得最佳控制体验
- 建议在5GHz Wi-Fi网络下使用以减少延迟
- 定期检查电池电量避免意外断电
- 在使用前确保机器人周围环境安全